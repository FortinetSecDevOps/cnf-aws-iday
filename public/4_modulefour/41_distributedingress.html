<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.86.0" />
    <meta name="description" content="FortiGate CNF Workshop">
<meta name="author" content="Hiruy Aberra">

    <link rel="icon" href="https://www.fortinet.com/etc/designs/fortinet/favicon.ico" type="image/x-icon" />

    <title>Distributed Ingress :: English</title>

    
    <link href="/cnf-aws-iday/css/nucleus.css?1676388143" rel="stylesheet">
    <link href="/cnf-aws-iday/css/fontawesome-all.min.css?1676388143" rel="stylesheet">
    <link href="/cnf-aws-iday/css/hybrid.css?1676388143" rel="stylesheet">
    <link href="/cnf-aws-iday/css/featherlight.min.css?1676388143" rel="stylesheet">
    <link href="/cnf-aws-iday/css/perfect-scrollbar.min.css?1676388143" rel="stylesheet">
    <link href="/cnf-aws-iday/css/auto-complete.css?1676388143" rel="stylesheet">
    <link href="/cnf-aws-iday/css/atom-one-dark-reasonable.css?1676388143" rel="stylesheet">
    <link href="/cnf-aws-iday/css/theme.css?1676388143" rel="stylesheet">
    <link href="/cnf-aws-iday/css/hugo-theme.css?1676388143" rel="stylesheet">
    
    <link href="/cnf-aws-iday/css/theme-red.css?1676388143" rel="stylesheet">
    
    

    <script src="/cnf-aws-iday/js/jquery-3.3.1.min.js?1676388143"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/cnf-aws-iday/4_modulefour/41_distributedingress.html">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a href="/cnf-aws-iday/" title="Fortinet AWS Immersion Day"><img style="vertical-align:middle" src="/cnf-aws-iday/images/Fortinet-logo-rgb-white-red.svg" height="70px"></a>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/cnf-aws-iday/js/lunr.min.js?1676388143"></script>
<script type="text/javascript" src="/cnf-aws-iday/js/auto-complete.js?1676388143"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/fortinetsecdevops.github.io\/cnf-aws-iday\/";
    
</script>
<script type="text/javascript" src="/cnf-aws-iday/js/search.js?1676388143"></script>

    
  </div>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/cnf-aws-iday/1_moduleone.html" title="Introduction" class="dd-item
        
        
        
        ">
      <a href="/cnf-aws-iday/1_moduleone.html">
          Introduction
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/cnf-aws-iday/2_moduletwo.html" title="Workshop Prerequisites" class="dd-item
        
        
        
        ">
      <a href="/cnf-aws-iday/2_moduletwo.html">
          Workshop Prerequisites
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/cnf-aws-iday/2_moduletwo/21_logistics.html" title="Workshop Logistics" class="dd-item ">
        <a href="/cnf-aws-iday/2_moduletwo/21_logistics.html">
        Workshop Logistics
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/cnf-aws-iday/2_moduletwo/22_awsnetworkingconcepts.html" title="AWS Networking Concepts" class="dd-item ">
        <a href="/cnf-aws-iday/2_moduletwo/22_awsnetworkingconcepts.html">
        AWS Networking Concepts
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/cnf-aws-iday/2_moduletwo/23_awscommonarchitecturepatterns.html" title="AWS Common Architecture Patterns" class="dd-item ">
        <a href="/cnf-aws-iday/2_moduletwo/23_awscommonarchitecturepatterns.html">
        AWS Common Architecture Patterns
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/cnf-aws-iday/2_moduletwo/24_fortigatecnfterminology.html" title="FortiGate CNF Terminology" class="dd-item ">
        <a href="/cnf-aws-iday/2_moduletwo/24_fortigatecnfterminology.html">
        FortiGate CNF Terminology
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/cnf-aws-iday/3_modulethree.html" title="Workshop Hands On" class="dd-item
        
        
        
        ">
      <a href="/cnf-aws-iday/3_modulethree.html">
          Workshop Hands On
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/cnf-aws-iday/3_modulethree/31_task1.html" title="Task 1: Subscribe to FortiGate CNF in AWS Marketplace" class="dd-item ">
        <a href="/cnf-aws-iday/3_modulethree/31_task1.html">
        Task 1: Subscribe to FortiGate CNF in AWS Marketplace
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/cnf-aws-iday/3_modulethree/32_task2.html" title="Task 2: Onboard an AWS account to FortiGate CNF" class="dd-item ">
        <a href="/cnf-aws-iday/3_modulethree/32_task2.html">
        Task 2: Onboard an AWS account to FortiGate CNF
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/cnf-aws-iday/3_modulethree/33_task3.html" title="Task 3: Deploying CNF Instances and GWLBe endpoints" class="dd-item ">
        <a href="/cnf-aws-iday/3_modulethree/33_task3.html">
        Task 3: Deploying CNF Instances and GWLBe endpoints
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/cnf-aws-iday/3_modulethree/34_task4.html" title="Task 4: Create a policy set and apply it to a FortiGate CNF Instance" class="dd-item ">
        <a href="/cnf-aws-iday/3_modulethree/34_task4.html">
        Task 4: Create a policy set and apply it to a FortiGate CNF Instance
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/cnf-aws-iday/4_modulefour.html" title="Workshop Test Traffic" class="dd-item
        parent
        
        
        ">
      <a href="/cnf-aws-iday/4_modulefour.html">
          Workshop Test Traffic
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/cnf-aws-iday/4_modulefour/41_distributedingress.html" title="Distributed Ingress" class="dd-item active">
        <a href="/cnf-aws-iday/4_modulefour/41_distributedingress.html">
        Distributed Ingress
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/cnf-aws-iday/4_modulefour/42_distributedegress.html" title="Distributed Egress" class="dd-item ">
        <a href="/cnf-aws-iday/4_modulefour/42_distributedegress.html">
        Distributed Egress
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/cnf-aws-iday/4_modulefour/43_centralizedegress.html" title="Centralized Egress" class="dd-item ">
        <a href="/cnf-aws-iday/4_modulefour/43_centralizedegress.html">
        Centralized Egress
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/cnf-aws-iday/4_modulefour/44_centralizedeastwest.html" title="Centralized East West" class="dd-item ">
        <a href="/cnf-aws-iday/4_modulefour/44_centralizedeastwest.html">
        Centralized East West
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/cnf-aws-iday/5_modulefive.html" title="Providing Feedback" class="dd-item
        
        
        
        ">
      <a href="/cnf-aws-iday/5_modulefive.html">
          Providing Feedback
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>Helpful References</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://fortinet.com/aws"><i class='far fa-lightbulb'></i> Fortinet's AWS Microsite</a>
              </li>
          
              <li>
                  <a class="padding" href="https://aws.amazon.com/marketplace/search/results?searchTerms=fortinet"><i class='fas fa-tools'></i> AWS MP Listings for Fortinet</a>
              </li>
          
              <li>
                  <a class="padding" href="https://docs.fortinet.com/cloud-solutions/aws"><i class='far fa-lightbulb'></i> Fortinet in AWS Docs</a>
              </li>
          
              <li>
                  <a class="padding" href="https://docs.fortinet.com/product/fortigate-cnf"><i class='fas fa-chalkboard-teacher'></i> FortiGate CNF Docs</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      

      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>

    <a href="https://www.fortinet.com/corporate/about-us/privacy" target="_blank" rel="noreferrer noopener">Privacy</a> | <a
        href="https://www.fortinet.com/corporate/about-us/legal" target="_blank" rel="noreferrer noopener">Site Terms</a> | <a
        href="https://www.fortinet.com/corporate/about-us/about-us" target="_blank" rel="noreferrer noopener">About Us</a>

</left>
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/cnf-aws-iday/'>Secure AWS workloads with FortiGate CNF SaaS</a> > <a href='/cnf-aws-iday/4_modulefour.html'>Workshop Test Traffic</a> > Distributed Ingress
          
        
          
        
          
        
                 
                  </span>
                </div>
                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
          <div id="chapter">
        
        <div id="body-inner">
          

        


<h1 id="distributed-ingress">Distributed Ingress</h1>
<p>For this traffic flow we will focus on the Application VPC. Distributed ingress is commonly used when there is a need to inspect traffic for a VPC that is directly accessible with an attached IGW and resources with a public Elastic IP (EIP) or behind a public load balancer (ie ALB, NLB, etc). The benefit of this design is that traffic does not need to traverse additional AWS networking components for inspection so each VPC is isolated from others. The caveat to consider is that each VPC would need a directly attached IGW and resources such as load balancers, NAT GWs, etc that have additional cost.</p>
<p><img src="../images/image-dist-ingress-diag1.png" alt=""></p>
<p><strong>Step 1:</strong> An inbound connection starts with an external user initiating a connection to a public resource such as a public NLB. The public NLB has a DNS record that resolves to a public IP for one of the NLB&rsquo;s Elastic Network Interface (ENI) in either public subnet. The first packet (ie TCP SYN) will then be seen at the IGW attached to the VPC where the public NLB is deployed. Since there is a Ingress route table assigned to the IGW, traffic destined to either public subnet will be sent to the GWLBe endpoint in the same AZ.</p>

<div class="notices note" ><p>The IGW will perform destination NAT to change the public IP of the NLB to the private IP of the NLB ENI.</p>
</div>

<p><strong>Step 2:</strong> The traffic is received at the GWLBe endpoint which then routes the traffic to the associated GWLB ENI in the same AZ in the managed Fortinet AWS account/VPC. This is done behind the scene using AWS Private Link.</p>
<p><strong>Step 3:</strong> The traffic is received at the GWLB ENI and is then encapsulated in a GENEVE tunnel and routed to one of the instances in the FortiGate CNF auto scale group for traffic inspection. Post inspection, if the traffic is allowed, the instance will hairpin the traffic back to the same GWLB ENI over GENEVE. Then the GWLB ENI will hairpin the traffic back to the same GWLBe endpoint.</p>
<p><strong>Step 4:</strong> The GWLBe endpoint will then route the inspected traffic to the intrinsic router. The intrinsic router will route traffic directly to the NLB&rsquo;s ENI as specified in the VPC route table assigned to the subnet.</p>
<p><strong>Step 5:</strong> The NLB will send traffic to a healthy target, in either AZ since cross zone load balancing is enabled.</p>

<div class="notices note" ><p>The NLB will perform destination NAT to change the private IP to that of the healthy target.</p>
</div>

<p><strong>Step 6:</strong> The web server will receive the traffic and respond. The return traffic will flow these steps in reverse.</p>
<ul>
<li>
<ol>
<li>To test out this flow navigate to the AWS CloudFormation console and <strong>toggle the view nested button to off</strong> &gt; then select the stack name &gt; and on the details pane select the outputs tab. You should see the output for <strong>URLforApp1</strong>. Click on the value for that output to check that App1 is no longer reachable now. Click on the value for the output <strong>EncryptedURLforApp1</strong> and you will see the self-signed certificate warning. Once you accept the warning, you will see the test web page.</li>
</ol>
</li>
</ul>

<div class="notices info" ><p>You are now only allowing HTTPS inbound to your environment that is sourced from a public IP within the United States!</p>
</div>

<p><img src="../images/image-t5-1.png" alt=""></p>
<p><img src="../images/image-t5-2.png" alt=""></p>


<footer class="footline">
	
</footer>

        
            </div> 
        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/cnf-aws-iday/4_modulefour.html" title="Workshop Test Traffic"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/cnf-aws-iday/4_modulefour/42_distributedegress.html" title="Distributed Egress" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/cnf-aws-iday/js/clipboard.min.js?1676388143"></script>
    <script src="/cnf-aws-iday/js/perfect-scrollbar.min.js?1676388143"></script>
    <script src="/cnf-aws-iday/js/perfect-scrollbar.jquery.min.js?1676388143"></script>
    <script src="/cnf-aws-iday/js/jquery.sticky.js?1676388143"></script>
    <script src="/cnf-aws-iday/js/featherlight.min.js?1676388143"></script>
    <script src="/cnf-aws-iday/js/highlight.pack.js?1676388143"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/cnf-aws-iday/js/modernizr.custom-3.6.0.js?1676388143"></script>
    <script src="/cnf-aws-iday/js/learn.js?1676388143"></script>
    <script src="/cnf-aws-iday/js/hugo-learn.js?1676388143"></script>
    
        
            <script src="/cnf-aws-iday/mermaid/mermaid.js?1676388143"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

